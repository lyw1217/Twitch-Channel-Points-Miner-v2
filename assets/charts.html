<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitch-Channel-Points-Miner-v2</title>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.1/css/bulma.css" rel="stylesheet"/>
</head>

<body>
    <div class="container">
        <div style="text-align: center">
            <img width="600px" src="{{url_for('static', filename='banner.png')}}" alt="banner">
            <br>
            <div style="margin-top: -15px;">
                <a style="text-decoration: none;" href="https://github.com/Tkd-Alex/Twitch-Channel-Points-Miner-v2/blob/master/LICENSE">
                    <img alt="License" src="https://img.shields.io/github/license/Tkd-Alex/Twitch-Channel-Points-Miner-v2" />
                </a>
                <a style="text-decoration: none;" href="https://www.python.org/downloads/release/python-360/">
                    <img alt="Python3" src="https://img.shields.io/badge/built%20for-Python‚â•3.6-red.svg?style=flat">
                </a>
                <a style="text-decoration: none;" href="https://github.com/Tkd-Alex/Twitch-Channel-Points-Miner-v2/pulls">
                    <img alt="PRsWelcome" src="https://img.shields.io/badge/PRs-welcome-brightgreen.svg?style=flat" />
                </a>
                <a style="text-decoration: none;" href="https://github.com/Tkd-Alex/Twitch-Channel-Points-Miner-v2/stargazers">
                    <img alt="GitHub Repo stars" src="https://img.shields.io/github/stars/Tkd-Alex/Twitch-Channel-Points-Miner-v2" />
                </a>
                <a style="text-decoration: none;" href="https://github.com/Tkd-Alex/Twitch-Channel-Points-Miner-v2/issues?q=is%3Aissue+is%3Aclosed">
                    <img alt="GitHub closed issues" src="https://img.shields.io/github/issues-closed/Tkd-Alex/Twitch-Channel-Points-Miner-v2">
                </a>
                <a style="text-decoration: none;" href="https://github.com/Tkd-Alex/Twitch-Channel-Points-Miner-v2">
                    <img alt="GitHub last commit" src="https://img.shields.io/github/last-commit/Tkd-Alex/Twitch-Channel-Points-Miner-v2" />
                </a>
            </div>
        </div>
        <br>

        <div class="tabs">
            <ul>
                {% for streamer in streamers.split(',') %}
                    <li onClick="changeStreamer('{{streamer}}', {{loop.index}})"><a>{{ streamer.replace(".json", "")  }}</a></li>
                {% endfor %}
            </ul>
        </div>
        <div id="chart"></div>

        <hr>
        <div style="text-align: center">If you want to help on this project, please leave a star üåü and share it with your friends! üòé - A coffee is always a gesture of LOVE ‚ù§Ô∏è
            <a href="https://www.buymeacoffee.com/tkdalex" target="_blank">
                <img style="margin-bottom: -8px; margin-left: 10px;"  src="https://cdn.buymeacoffee.com/buttons/lato-yellow.png" alt="Buy Me A Coffee" height="5" width="138">
            </a>
        </div>
    </div>
</body>
<script type="text/javascript">
    // https://apexcharts.com/javascript-chart-demos/line-charts/zoomable-timeseries/
    var options = {
        series: [],
        chart: {
            type: 'area',
            stacked: false,
            height: 400,
            zoom: {
                type: 'x',
                enabled: true,
                autoScaleYaxis: true
            },
            toolbar: {
                autoSelected: 'zoom'
            }
        },
        dataLabels: {
            enabled: false
        },
        stroke: {
            curve: 'smooth',
        },
        markers: {
            size: 0,
        },
        title: {
            text: 'Channel points',
            align: 'left'
        },
        fill: {
            type: 'gradient',
            gradient: {
                shadeIntensity: 1,
                inverseColors: false,
                opacityFrom: 0.5,
                opacityTo: 0,
                stops: [0, 90, 100]
            },
        },
        yaxis: {
            title: {
                text: 'Channel points'
            },
        },
        xaxis: {
            type: 'datetime'
        },
        tooltip: {
            shared: false,
            x: {
                show: true,
                format: 'HH:mm:ss dd MMM',
            },
        },
        noData: {
            text: 'Loading...'
        }
    };

    var chart = new ApexCharts(document.querySelector("#chart"), options);
    var currentStreamer = null;

    $(document).ready(function() {
        chart.render();
        $("li").eq(0).click();
    });

    function changeStreamer(streamer, index) {
        $("li").removeClass( "is-active" )
        $("li").eq(index - 1).addClass('is-active');
        currentStreamer = streamer;
        getStreamerData(streamer);
    }

    function getStreamerData(streamer) {
        if(currentStreamer == streamer){
            $.getJSON(`./json/${streamer}`, function (response) {
                chart.clearAnnotations()
                chart.updateSeries([{
                    name: streamer.replace(".json", ""),
                    data: response["series"]
                }], true)
                response["points"].forEach(annotation => {
                    chart.addPointAnnotation(annotation, true)
                })
                setTimeout(function(){getStreamerData(streamer);}, 300000);  // 5 minutes
            });
        }
    }

</script>

</html>
